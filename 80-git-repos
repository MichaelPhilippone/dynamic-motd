#!/bin/bash
# Git repos needing attention

# Common locations to check
check_dirs=(
    /home/pi
    /home/pi/Projects
    /home/pi/Scripts
    /opt
)

found_issues=0

for base_dir in "${check_dirs[@]}"; do
    [[ ! -d "$base_dir" ]] && continue
    
    # Find git repos (max depth 3)
    while IFS= read -r -d '' git_dir; do
        repo_dir=$(dirname "$git_dir")
        repo_name=$(basename "$repo_dir")
        
        cd "$repo_dir" 2>/dev/null || continue
        
        # Check for uncommitted changes
        if ! git diff-index --quiet HEAD -- 2>/dev/null; then
            if [[ $found_issues -eq 0 ]]; then
                printf "\033[1mðŸ“¦ Git Repos Needing Attention:\033[0m\n"
                found_issues=1
            fi
            printf "  %-40s \033[33mâš¡ Uncommitted changes\033[0m\n" "$repo_name"
            continue
        fi
        
        # Check for unpushed commits (only if tracking remote)
        if git rev-parse --abbrev-ref @'{u}' &>/dev/null 2>&1; then
            unpushed=$(git log @'{u}'.. --oneline 2>/dev/null | wc -l)
            if [[ $unpushed -gt 0 ]]; then
                if [[ $found_issues -eq 0 ]]; then
                    printf "\033[1mðŸ“¦ Git Repos Needing Attention:\033[0m\n"
                    found_issues=1
                fi
                printf "  %-40s \033[33mâ¬† %d unpushed commits\033[0m\n" "$repo_name" "$unpushed"
            fi
        fi
    done < <(find "$base_dir" -maxdepth 3 -name .git -type d -print0 2>/dev/null)
done
